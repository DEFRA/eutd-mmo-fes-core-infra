name: $(BuildID)

trigger: none

parameters:
  - name: skipPRE1
    type: boolean
    default: false
  - name: deployToDevelopmentEnvironment
    displayName: "Deploy from Feature Branch"
    type: boolean
    default: true
  - name: additionalRepositories
    displayName: Additional repositories that needs reference in the process
    type: object
    default: []

resources:
  repositories:
    - repository: MMOPipelineCommon
      name: "DEFRA/eutd-mmo-fes-pipeline-common"
      endpoint: DEFRA
      type: github
      ref: refs/heads/feature/pipeline-paths-fix

extends:
  template: /includes/infra-deploy.yaml@MMOPipelineCommon
  parameters:
    deployToDevelopmentEnvironment: ${{ parameters.deployToDevelopmentEnvironment }}
    deployToSecondaryRegion: false
    additionalRepositories:
      - MMOPipelineCommon
    filePathsForTransform: |
      **/templates/monitoring/monitoring.json  
    groupedDeployments:
      - name: Azure_Metric_Alerts
        timeoutInMinutes: 60
        deployments:
          - name: "Create_Azure_Metric_Alerts"
            scriptRepo: MMOPipelineCommon
            type: script
            scriptType: AzurePowerShell
            path: "scripts/CreateMetricAlertFunctions.ps1"
            scriptArguments: >-
              -manifestFilePath "$(Pipeline.Workspace)/s/self/templates/monitoring/monitoring.json"
            failOnStandardError: true            
        skipPRE1: ${{ parameters.skipPRE1 }}
